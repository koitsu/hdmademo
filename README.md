# hdmademo

* [ca65](ca65/) -- `hdmademo` ported to ca65.  LoROM, normal speed
* [ca65-fastrom](ca65-fastrom/) -- same as `ca65` but LoROM, high speed (3.65MHz)
* [original](original/) -- the original code/files to `hdmademo`, circa 1993

## History

In August 1993, minus (a.k.a. Norman Yen) released a small SNES demo called
`hdmademo`.  The demo consisted of an almost-full-screen copperband butterfly
fish moving moving from left to right, and up/down in a smooth sine wave.  In
the background, a coral reef waved back and forth also in a sine wave pattern,
but used HDMA to achieve the effect.  There was no music/sound, but source code
was included.

The code was intended for Tricks Asssembler for MS-DOS (a 65816 cross assembler
also done by minus), but could be later ported to work on x816 for MS-DOS (a
newer and more feature-filled 65816 cross assembler _also_ by minus).

The graphics (`butrfish.dat` and `reef.dat`) were in native SNES mode 1 (4bpp)
format, likely converted with either `GIF2SNES` or `GIF2SOPT` (author unknown)
or `RAW2SNES` (author minus).  Original source images were not included.

The remaining two `.bin` files for sine wave data were generated by unknown
tools.  I suspect minus had home-grown tools for generating these.

## Present day

In April and May of 2019, I did a couple live Twitch streams where I ported
the source for `hdmademo` to with other assemblers such as x816 and ca65,
using Windows-based tools.  I had some additional goals:

* Strict KISS compliance, e.g. keep code in a single file, do not make use of
  IDEs, do not excessively "modularise" code, no excess dependencies, etc.
* Convert the source to several assemblers, mainly x816, ca65, and YMAS (an
  up-and-coming multi-CPU cross assembler _again_ by minus)
* Explain on the stream what each line or section of code was doing.  I found
  this to be challenging, since HDMA in particular is something I never spent
  much time with.
* Ensure the demo worked properly on both hardware and emulators, e.g.
  * Mesen-S
  * bsnes-plus
  * SNES9x
  * ZSNES
  * bsnes
  * Actual hardware using an SD2SNES (rather than a Super Wild Card copier)
* Make the demo easier to understand for newbies starting out (better comments)
* Add something minor, like speeding up the fish's movement if holding down a
  particular joypad button
* Provide a HiROM (mode 21) version, so people could see how to transition
  their own LoROM (mode 20) code to HiROM
* Make use of 3.58MHz mode and explain how that's accomplished
* Enhance the demo by adding a text scroller to BG3 or with sprites.  (I got this
  partially working, but only with static content (i.e. not a real scroller))
* Add music/sound (warning: highly unlikely, as SPC700 is not my forte)

Many of these I did not do on stream, nor did I complete at all.  I did, however,
verify my results on both several emulators and hardware.

It's my goal with this repository to accomplish all of the above, and leave folks
with something that helps folks starting out understand things a bit better.  My
old iNFiNiTY demo circa early 90s was intended for this as well, but I didn't do
a particularly good job of it.

## Bugfixes

I fixed several minor bugs in this demo which were missed, or masked due to use
of SNES console copiers back in the 90s:

* Make the SNES init routine comply with the "official" way per Nintendo
* Neither RAM, WRAM, nor PPU RAM were initialised
* NMI routine was missing NMI latch clear (`lda $4210`)
* Very first frame was partially corrupt due to HDMA having not run yet
* Expand ROM size to 2mbit / 256KByte to be header-compliant (official sources
  claim 2mbit is the smallest permitted size)

## Photograph/image sources

As mentioned in the History section, the original authors or sources of both
the copperband butterfly fish and the reef are unknown.  These were images
which were distributed on BBSes worldwide, and later on CD-ROMs.  

If anyone knows who the photographers are, or who owns copyright (if any) to
these images, please let me know.

Some references to these original images can still be found online today:

### BUTRFISH

* Dates back to at least 1990
* http://cd.textfiles.com/somuch/smsharew/GIFS/BUTRFISH.GIF
* http://cd.textfiles.com/internetconnection/gifb/butrfish.gif
* http://textfiles.com/bbs/FILELISTS/allfile3.txt
* Amiga HAM8: http://aminet.net/package/demo/aga/ADemo93.5
* Amiga HAM8: http://www.pentor.gmxhome.de/Guide/Customs-FAKTEN.html

### REEF

* Dates back to at least 1992
* http://cd.textfiles.com/gifgalaxy/PIC/GIF08/REEF1.GIF
* http://cd.textfiles.com/gifgalaxy/KATALOG/GIF08.TXT
* http://cd.textfiles.com/somuch/smscreenw/SCREEN.TXT

